#Add user on hosts
- name: Add the user 'hw21_1 (hw21_2)' with a sh shell and '/opt/hw21' home directory
  ansible.builtin.user:
   name: "{{ item.name }}"
   shell: "{{ item.shell }}"
   home: "{{ item.home }}"
   groups: "{{ item.groups }}"
   password: "{{ default_password | password_hash('sha512','A512') }}"
   state: present
  with_items: "{{ hw21_user }}"
  register: output
  no_log: true
  become: true

#Reset connection  
- name: reset ssh connection to allow user changes
  meta: reset_connection

#- name: Print User password
#  ansible.builtin.debug:
#   msg: "{{ output.stdout_lines }}"
