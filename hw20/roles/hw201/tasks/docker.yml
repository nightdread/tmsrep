---
#Ubuntu
- name: "Install Docker on Ubuntu"
  block:
    - name: "Set up the repository"
      ansible.builtin.package:
       name: "{{ item }}"
       update_cache: yes
      loop:
       - apt-transport-https
       - ca-certificates
       - curl
       - gnupg
       - lsb-release

    - name: "Add GPG key"
      ansible.builtin.apt_key:
       url: https://download.docker.com/linux/ubuntu/gpg
       state: present
       
    - name: "Add repos"
      ansible.builtin.apt_repository:
       repo: deb https://download.docker.com/linux/ubuntu focal stable
       state: present
  when: ansible_facts['os_family'] == "Debian"
  become: true

#CentOS
- name: "Install Docker on CentOS"
  block:
    - name: "Add Docker repo"
      ansible.builtin.get_url:
       url: https://download.docker.com/linux/centos/docker-ce.repo
       dest: /etc/yum.repos.d/docer-ce.repo 
  when: ansible_facts['os_family'] == "RedHat"
  become: true

#Linux
- name: "Install Docker Engine & add Docker to start up"
  block:
    - name: "Install Docker Engine"
      ansible.builtin.package:
       name: "{{ item }}"
       state: latest
      loop:
        - docker-ce
        - docker-ce-cli
        - containerd.io

    - name: "Add Docker to start up"
      ansible.builtin.service:
       name: docker
       state: started
       enabled: yes
  become: true
